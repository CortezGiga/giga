<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Estimativa de Projeto</title>
    
    <!-- Font Awesome para ícones modernos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- SheetJS para exportar/importar Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <!-- jsPDF para exportar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Cores principais - tema dark */
            --bg-primary: #0F0F0F;
            --bg-secondary: #1A1A1A;
            --bg-tertiary: #242424;
            --bg-hover: #2A2A2A;
            
            /* Textos */
            --text-primary: #E8E8E8;
            --text-secondary: #A0A0A0;
            --text-muted: #707070;
            
            /* Bordas */
            --border-color: #2A2A2A;
            --border-hover: #3A3A3A;
            
            /* Cores de destaque */
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-darker: #6D28D9;
            --secondary: #A78BFA;
            --accent: #C4B5FD;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            padding: 20px;
            min-height: 100vh;
            color: var(--text-primary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
            border: 1px solid var(--border-color);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            padding: 48px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--border-color);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            animation: pulse 15s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.75em;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.15em;
            opacity: 0.95;
            font-weight: 400;
        }

        /* NOTIFICAÇÕES */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            z-index: 10000;
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: none;
            backdrop-filter: blur(10px);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.show {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification i {
            font-size: 1.2em;
        }

        .notification.success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }

        .notification.error {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
        }

        .notification.info {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
        }

        .actions {
            padding: 24px 30px;
            background: var(--bg-tertiary);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 1px solid var(--border-color);
        }

        .btn {
            padding: 12px 24px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: var(--border-hover);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn i {
            font-size: 1.1em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-danger:hover {
            background: #DC2626;
            border-color: #DC2626;
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        .btn-secondary:hover {
            background: #353535;
            border-color: var(--border-hover);
        }

        .btn-info {
            background: var(--info);
            color: white;
            border-color: var(--info);
        }

        .btn-info:hover {
            background: #2563EB;
            border-color: #2563EB;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .btn-warning:hover {
            background: #D97706;
            border-color: #D97706;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.875em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: var(--border-hover);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .section-header {
            padding: 18px 25px;
            font-size: 1.25em;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-header i {
            font-size: 1.2em;
        }

        .section-config .section-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .section-info .section-header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
        }

        .section-tasks .section-header {
            background: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
        }

        .section-timeline .section-header {
            background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%);
        }

        .section-summary .section-header {
            background: linear-gradient(135deg, var(--primary-darker) 0%, #5B21B6 100%);
        }

        .section-body {
            padding: 28px;
            background: var(--bg-tertiary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .form-group label i {
            color: var(--primary);
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            line-height: 1.6;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .checkbox-group:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .config-item {
            background: var(--bg-secondary);
            padding: 18px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--primary);
            transition: all 0.2s ease;
        }

        .config-item:hover {
            border-color: var(--border-hover);
            background: var(--bg-hover);
            transform: translateX(2px);
        }

        .config-item label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .config-item label i {
            color: var(--primary);
        }

        .config-item input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            text-align: center;
            font-weight: 700;
            color: var(--primary);
            background: var(--bg-primary);
            transition: all 0.2s ease;
        }

        .config-item input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .formula-explanation {
            background: var(--bg-secondary);
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }

        .formula-explanation h3 {
            color: var(--warning);
            margin-bottom: 18px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .formula-explanation h3 i {
            font-size: 1.3em;
        }

        .formula-box {
            background: var(--bg-primary);
            padding: 18px;
            border-radius: 10px;
            margin: 12px 0;
            border-left: 3px solid var(--warning);
            transition: all 0.2s ease;
        }

        .formula-box:hover {
            background: var(--bg-hover);
            transform: translateX(2px);
        }

        .formula-box strong {
            color: var(--primary);
            font-size: 1.05em;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .formula-box strong i {
            color: var(--warning);
        }

        .formula-box p {
            margin: 6px 0;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .tasks-table {
            width: 100%;
            overflow-x: auto;
            border-radius: 12px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1000px;
        }

        thead th {
            background: var(--bg-secondary);
            padding: 16px 12px;
            text-align: center;
            font-weight: 700;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            font-size: 0.9em;
        }

        thead th:first-child {
            border-top-left-radius: 10px;
        }

        thead th:last-child {
            border-top-right-radius: 10px;
        }

        tbody td {
            padding: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: all 0.2s ease;
            background: var(--bg-tertiary);
        }

        tbody tr {
            transition: all 0.2s ease;
            cursor: move;
        }

        tbody tr:hover {
            background: var(--bg-hover);
        }

        tbody tr.dragging {
            opacity: 0.5;
            background: var(--primary);
        }

        tbody td input,
        tbody td select,
        tbody td textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        tbody td textarea {
            resize: vertical;
            min-height: 60px;
            line-height: 1.5;
        }

        tbody td input:focus,
        tbody td select:focus,
        tbody td textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
            outline: none;
        }

        tbody td input[type="number"] {
            text-align: center;
            font-weight: 600;
        }

        tbody td.calculated {
            background: rgba(16, 185, 129, 0.1);
            font-weight: 700;
            color: var(--success);
            font-size: 1.05em;
            border-color: rgba(16, 185, 129, 0.2);
        }

        tbody td.actions {
            background: rgba(239, 68, 68, 0.05);
        }

        tbody td.drag-handle {
            cursor: grab;
            background: var(--bg-secondary);
            color: var(--text-muted);
        }

        tbody td.drag-handle:active {
            cursor: grabbing;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .summary-item {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            text-align: center;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .summary-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .summary-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .summary-item label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: 0.95em;
        }

        .summary-item label i {
            font-size: 1.2em;
            color: var(--primary);
        }

        .summary-item .value {
            font-size: 2em;
            font-weight: 800;
            color: var(--text-primary);
        }

        /* TIMELINE */
        .timeline-container {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            position: relative;
            padding: 20px 0 20px 60px;
            border-left: 2px solid var(--border-color);
            margin-left: 20px;
            transition: all 0.2s ease;
        }

        .timeline-item:hover {
            border-left-color: var(--primary);
        }

        .timeline-item:last-child {
            border-left: none;
        }

        .timeline-icon {
            position: absolute;
            left: -13px;
            top: 20px;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: var(--primary);
            font-weight: bold;
        }

        .timeline-item.qa .timeline-icon {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .timeline-item.teste .timeline-icon {
            background: var(--info);
            border-color: var(--info);
            color: white;
        }

        .timeline-item.correcao .timeline-icon {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .timeline-content {
            background: var(--bg-secondary);
            padding: 16px 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .timeline-item:hover .timeline-content {
            border-color: var(--border-hover);
            transform: translateX(4px);
        }

        .timeline-content h4 {
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.05em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timeline-content h4 i {
            font-size: 0.9em;
            color: var(--primary);
        }

        .timeline-content p {
            color: var(--text-secondary);
            margin: 4px 0;
            font-size: 0.95em;
        }

        .timeline-content .task-desc {
            color: var(--text-muted);
            font-size: 0.9em;
            font-style: italic;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
        }

        .timeline-date {
            display: inline-block;
            padding: 6px 12px;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85em;
            margin-top: 8px;
        }

        .timeline-item.qa .timeline-date {
            background: var(--success);
        }

        .timeline-item.teste .timeline-date {
            background: var(--info);
        }

        .timeline-item.correcao .timeline-date {
            background: var(--warning);
        }

        .legend {
            background: var(--bg-secondary);
            padding: 18px;
            border-radius: 12px;
            margin-top: 24px;
            border: 1px solid var(--border-color);
            font-size: 0.95em;
            color: var(--text-secondary);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .legend i {
            font-size: 1.3em;
            color: var(--warning);
        }

        .toggle-config {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .toggle-config:hover {
            opacity: 0.8;
        }

        .config-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .config-section.active {
            max-height: 2500px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 36px;
            border-radius: 16px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border-color);
            animation: slideInDown 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h2 {
            margin-bottom: 16px;
            color: var(--danger);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .modal-content h2 i {
            font-size: 1.3em;
        }

        .modal-content p {
            margin-bottom: 28px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .task-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 18px 0;
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-hover);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #404040;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .container {
                border-radius: 12px;
            }
        }

        #pdfContent {
            display: none;
        }

        /* Select dropdown dark theme */
        select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- NOTIFICAÇÃO -->
    <div id="notification" class="notification"></div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <h1><i class="fas fa-clipboard-check"></i> Estimativa de Projeto</h1>
                <p>Sistema completo de estimativa com cálculo automático de prazos e linha do tempo</p>
            </div>
        </div>

        <!-- ACTIONS -->
        <div class="actions">
            <button class="btn btn-warning" onclick="copiarParaClickUp()">
                <i class="fas fa-copy"></i> Copiar para ClickUp
            </button>
            <button class="btn btn-success" onclick="exportarExcel()">
                <i class="fas fa-file-excel"></i> Exportar Excel
            </button>
            <button class="btn btn-info" onclick="document.getElementById('importarExcel').click()">
                <i class="fas fa-file-upload"></i> Importar Excel
            </button>
            <input type="file" id="importarExcel" accept=".xlsx,.xls" style="display:none" onchange="importarExcel(event)">
            <button class="btn btn-success" onclick="exportarPDF()">
                <i class="fas fa-file-pdf"></i> Exportar PDF
            </button>
            <button class="btn btn-danger" onclick="abrirModalLimpar()">
                <i class="fas fa-trash-alt"></i> Limpar Dados
            </button>
            <button class="btn btn-secondary" onclick="toggleConfig()">
                <i class="fas fa-cog"></i> Configurações
            </button>
        </div>

        <!-- CONTENT -->
        <div class="content">
            <!-- CONFIGURAÇÃO -->
            <div class="section section-config">
                <div class="section-header toggle-config" onclick="toggleConfig()">
                    <span><i class="fas fa-sliders-h"></i> Configuração dos Parâmetros de Cálculo</span>
                    <span style="font-size: 0.75em; font-weight: 400; opacity: 0.8;"><i class="fas fa-chevron-down"></i> Clique para expandir/recolher</span>
                </div>
                <div class="section-body config-section" id="configSection">
                    <h3 style="margin-bottom: 18px; color: var(--primary); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-line"></i> Parâmetros de Tempo
                    </h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label><i class="fas fa-bug"></i> % Tempo de QA/Teste</label>
                            <input type="number" id="percQA" value="30" min="0" max="100" step="1" onchange="calcularTudo()">
                        </div>
                        <div class="config-item">
                            <label><i class="fas fa-link"></i> Fator Dependência Externa</label>
                            <input type="number" id="fatorDep" value="1.3" min="1" max="3" step="0.1" onchange="calcularTudo()">
                        </div>
                        <div class="config-item">
                            <label><i class="fas fa-question-circle"></i> % Incerteza Padrão</label>
                            <input type="number" id="percIncerteza" value="15" min="0" max="100" step="1" onchange="calcularTudo()">
                        </div>
                    </div>

                    <h3 style="margin: 28px 0 18px; color: var(--secondary); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-plus-circle"></i> Tempos Adicionais
                    </h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label><i class="fas fa-file-alt"></i> % Doc. e Reuniões</label>
                            <input type="number" id="percDoc" value="15" min="0" max="100" step="1" onchange="calcularTudo()">
                        </div>
                        <div class="config-item">
                            <label><i class="fas fa-vial"></i> Horas Teste Fluxo QA</label>
                            <input type="number" id="horasTesteFluxo" value="4" min="0" max="40" step="0.5" onchange="calcularTudo()">
                        </div>
                        <div class="config-item">
                            <label><i class="fas fa-wrench"></i> % Tempo Correções</label>
                            <input type="number" id="percCorrecoes" value="20" min="0" max="100" step="1" onchange="calcularTudo()">
                        </div>
                    </div>

                    <!-- EXPLICAÇÃO DO CÁLCULO -->
                    <div class="formula-explanation">
                        <h3><i class="fas fa-calculator"></i> Como Funciona o Cálculo?</h3>
                        
                        <div class="formula-box">
                            <strong><i class="fas fa-1"></i> Tempo de Desenvolvimento</strong>
                            <p><strong>Fórmula:</strong> Tempo = Horas Estimadas × Fator Dependência</p>
                            <p>Se a tarefa tem dependência externa, multiplica pelo fator configurado (padrão 1.3x).</p>
                        </div>

                        <div class="formula-box">
                            <strong><i class="fas fa-2"></i> Incerteza</strong>
                            <p><strong>Fórmula:</strong> Tempo com Incerteza = Tempo × (1 + % Incerteza)</p>
                            <p>Se marcado "Sim", adiciona a porcentagem de incerteza configurada (padrão 15%).</p>
                        </div>

                        <div class="formula-box">
                            <strong><i class="fas fa-3"></i> QA/Teste</strong>
                            <p><strong>Fórmula:</strong> Tempo QA = Total Dev × (% QA ÷ 100)</p>
                            <p>Calculado sobre todas as tarefas de desenvolvimento (padrão 30%).</p>
                        </div>

                        <div class="formula-box">
                            <strong><i class="fas fa-4"></i> Tempos Adicionais</strong>
                            <p><strong>Documentação/Reuniões:</strong> 15% do tempo total (não aparece na timeline)</p>
                            <p><strong>Teste de Fluxo:</strong> 4 horas fixas (aparece na timeline)</p>
                            <p><strong>Correções:</strong> 20% do tempo total (aparece na timeline)</p>
                        </div>

                        <div class="formula-box">
                            <strong><i class="fas fa-5"></i> Horário de Trabalho</strong>
                            <p><strong>Normal:</strong> 8h-12h e 13h-18h = 9 horas diárias</p>
                            <p><strong>Estagiário:</strong> 6 horas diárias</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INFORMAÇÕES -->
            <div class="section section-info">
                <div class="section-header">
                    <i class="fas fa-info-circle"></i> Informações do Desenvolvedor e Projeto
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> Nome do Desenvolvedor:</label>
                            <input type="text" id="nomeDev" placeholder="Digite o nome do desenvolvedor">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-calendar-day"></i> Data de Início:</label>
                            <input type="date" id="dataInicio" onchange="calcularTudo()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-sun"></i> Período de Início:</label>
                            <select id="periodoInicio" onchange="calcularTudo()">
                                <option value="manha">Manhã (8h-12h)</option>
                                <option value="tarde">Tarde (13h-18h)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="isEstagiario" onchange="calcularTudo()">
                                <label for="isEstagiario">
                                    <i class="fas fa-graduation-cap"></i>
                                    É Estagiário? (6h/dia)
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="incluirTesteFluxo" checked onchange="calcularTudo()">
                                <label for="incluirTesteFluxo">
                                    <i class="fas fa-vial"></i>
                                    Incluir Teste de Fluxo no total e timeline?
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-project-diagram"></i> Nome da Demanda/Projeto:</label>
                        <textarea id="nomeDemanda" placeholder="Digite o nome e descrição detalhada do projeto..." rows="3"></textarea>
                    </div>
                </div>
            </div>

            <!-- TAREFAS -->
            <div class="section section-tasks">
                <div class="section-header">
                    <span><i class="fas fa-tasks"></i> Lista de Tarefas (arraste para reordenar)</span>
                </div>
                <div class="section-body">
                    <div class="task-controls">
                        <button class="btn btn-success btn-small" onclick="adicionarTarefa()">
                            <i class="fas fa-plus-circle"></i> Adicionar Tarefa
                        </button>
                        <button class="btn btn-danger btn-small" onclick="removerUltimaTarefa()">
                            <i class="fas fa-minus-circle"></i> Remover Última
                        </button>
                    </div>
                    <div class="tasks-table">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 40px;"><i class="fas fa-bars"></i></th>
                                    <th style="width: 40px;">Nº</th>
                                    <th style="width: 280px;"><i class="fas fa-edit"></i> Tarefa Técnica</th>
                                    <th style="width: 100px;"><i class="fas fa-link"></i> Dep. Externa?</th>
                                    <th style="width: 100px;"><i class="fas fa-hourglass-half"></i> Horas Est.</th>
                                    <th style="width: 100px;"><i class="fas fa-question-circle"></i> Incerteza?</th>
                                    <th style="width: 100px;"><i class="fas fa-calculator"></i> Total Horas</th>
                                    <th style="width: 80px;"><i class="fas fa-times"></i> Ação</th>
                                </tr>
                            </thead>
                            <tbody id="tarefasBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- LINHA DO TEMPO -->
            <div class="section section-timeline">
                <div class="section-header">
                    <i class="fas fa-stream"></i> Linha do Tempo - Datas de Entrega
                </div>
                <div class="section-body">
                    <div class="timeline-container" id="timelineContainer">
                        <p style="text-align: center; color: var(--text-muted); padding: 40px;">Configure as informações acima para visualizar a linha do tempo das entregas.</p>
                    </div>
                </div>
            </div>

            <!-- RESUMO -->
            <div class="section section-summary">
                <div class="section-header">
                    <i class="fas fa-chart-pie"></i> Resumo Final
                </div>
                <div class="section-body">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <label><i class="fas fa-code"></i> Total Horas Desenvolvimento:</label>
                            <div class="value" id="totalHorasDev">0.0h</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-bug"></i> Total Horas QA/Teste:</label>
                            <div class="value" id="totalHorasQA">0.0h</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-file-alt"></i> Horas Doc/Reuniões:</label>
                            <div class="value" id="totalHorasDoc">0.0h</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-vial"></i> Horas Teste Fluxo:</label>
                            <div class="value" id="totalHorasTesteFluxo">0.0h</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-wrench"></i> Horas Correções:</label>
                            <div class="value" id="totalHorasCorrecoes">0.0h</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-clock"></i> Total Geral de Horas:</label>
                            <div class="value" id="totalHoras">0.0h</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-calendar-check"></i> Data de Início:</label>
                            <div class="value" id="dataInicioSummary">--/--/----</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-flag-checkered"></i> Data de Término Dev:</label>
                            <div class="value" id="dataTerminoDev">--/--/----</div>
                        </div>
                        <div class="summary-item">
                            <label><i class="fas fa-check-double"></i> Data Final (Completo):</label>
                            <div class="value" id="dataTermino">--/--/----</div>
                        </div>
                    </div>

                    <div class="legend">
                        <i class="fas fa-info-circle"></i>
                        <span><strong>Salvamento automático:</strong> Os dados são salvos automaticamente no seu navegador. 
                        Use "Exportar Excel" ou "Exportar PDF" para criar backup ou compartilhar com a equipe.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CONFIRMAÇÃO -->
    <div class="modal" id="modalLimpar">
        <div class="modal-content">
            <h2><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h2>
            <p>Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita!</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="fecharModalLimpar()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn btn-danger" onclick="limparDados()">
                    <i class="fas fa-check"></i> Sim, Limpar Tudo
                </button>
            </div>
        </div>
    </div>

    <!-- Conteúdo para PDF (oculto) -->
    <div id="pdfContent" style="display: none; padding: 40px; background: white; max-width: 800px;">
        <h1 style="text-align: center; color: #7C3AED; margin-bottom: 30px;">Estimativa de Projeto</h1>
        <div id="pdfInfo"></div>
        <div id="pdfTarefas"></div>
        <div id="pdfTimeline"></div>
        <div id="pdfResumo"></div>
    </div>

    <script>
        let tarefasCount = 5;
        let tarefasIds = [];
        let draggedElement = null;
        let timelineGlobal = []; // Armazena a timeline globalmente

        // ============== COPIAR PARA CLICKUP ==============
        function copiarParaClickUp() {
            if (timelineGlobal.length === 0) {
                mostrarNotificacao('Configure as tarefas e datas antes de copiar!', 'error');
                return;
            }

            let textoClickUp = '';
            
            // Percorrer tarefas de desenvolvimento, QA e Teste de Fluxo (não incluir Correções)
            timelineGlobal.forEach(item => {
                if (item.tipo === 'dev' || item.tipo === 'qa' || item.tipo === 'teste') {
                    textoClickUp += `[${item.dataTermino}] ${item.tarefa}\n`;
                }
            });

            if (textoClickUp === '') {
                mostrarNotificacao('Nenhuma tarefa encontrada!', 'error');
                return;
            }

            // Copiar para clipboard
            navigator.clipboard.writeText(textoClickUp.trim()).then(() => {
                mostrarNotificacao('Tarefas copiadas para o ClickUp! Cole com Ctrl+V', 'success');
            }).catch(err => {
                // Fallback para navegadores mais antigos
                const textarea = document.createElement('textarea');
                textarea.value = textoClickUp.trim();
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    mostrarNotificacao('Tarefas copiadas para o ClickUp! Cole com Ctrl+V', 'success');
                } catch (err) {
                    mostrarNotificacao('Erro ao copiar. Tente novamente.', 'error');
                }
                document.body.removeChild(textarea);
            });
        }

        // ============== NOTIFICAÇÕES ==============
        function mostrarNotificacao(mensagem, tipo = 'success') {
            const notif = document.getElementById('notification');
            
            let icone = '<i class="fas fa-check-circle"></i>';
            if (tipo === 'error') icone = '<i class="fas fa-times-circle"></i>';
            if (tipo === 'info') icone = '<i class="fas fa-info-circle"></i>';
            
            notif.innerHTML = icone + '<span>' + mensagem + '</span>';
            notif.className = `notification ${tipo} show`;
            
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        // ============== STORAGE SEGURO ==============
        function salvarNoStorage(chave, valor) {
            try {
                localStorage.setItem(chave, valor);
                return true;
            } catch (e) {
                console.warn('localStorage não disponível, usando sessionStorage');
                try {
                    sessionStorage.setItem(chave, valor);
                    return true;
                } catch (e2) {
                    console.warn('sessionStorage não disponível');
                    return false;
                }
            }
        }

        function lerDoStorage(chave) {
            try {
                let valor = localStorage.getItem(chave);
                if (valor) return valor;
            } catch (e) {}
            
            try {
                let valor = sessionStorage.getItem(chave);
                if (valor) return valor;
            } catch (e) {}
            
            return null;
        }

        function removerDoStorage(chave) {
            try {
                localStorage.removeItem(chave);
            } catch (e) {}
            try {
                sessionStorage.removeItem(chave);
            } catch (e) {}
        }

        // ============== DRAG AND DROP ==============
        function setupDragAndDrop() {
            const tbody = document.getElementById('tarefasBody');
            
            tbody.addEventListener('dragstart', function(e) {
                if (e.target.tagName === 'TR') {
                    draggedElement = e.target;
                    e.target.classList.add('dragging');
                }
            });

            tbody.addEventListener('dragend', function(e) {
                if (e.target.tagName === 'TR') {
                    e.target.classList.remove('dragging');
                }
            });

            tbody.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(tbody, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) {
                    tbody.appendChild(draggable);
                } else {
                    tbody.insertBefore(draggable, afterElement);
                }
            });

            tbody.addEventListener('drop', function(e) {
                e.preventDefault();
                renumerarTarefas();
                salvarAutomatico();
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('tr:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // ============== CRIAR TAREFAS ==============
        function criarTarefas(quantidade = 5) {
            const tbody = document.getElementById('tarefasBody');
            tbody.innerHTML = '';
            tarefasIds = [];
            
            for (let i = 1; i <= quantidade; i++) {
                adicionarLinhaTarefa(i);
            }
            tarefasCount = quantidade;
            setupDragAndDrop();
        }

        function adicionarLinhaTarefa(num) {
            const tbody = document.getElementById('tarefasBody');
            const tr = document.createElement('tr');
            tr.id = `tarefa_row_${num}`;
            tr.draggable = true;
            tr.innerHTML = `
                <td class="drag-handle"><i class="fas fa-grip-vertical"></i></td>
                <td><strong>${num}</strong></td>
                <td>
                    <textarea id="tarefa_${num}" placeholder="Descreva a tarefa..." onchange="salvarAutomatico()" rows="2"></textarea>
                </td>
                <td>
                    <select id="dep_${num}" onchange="calcularTarefa(${num})">
                        <option value="Não">Não</option>
                        <option value="Sim">Sim</option>
                    </select>
                </td>
                <td>
                    <input type="number" id="horas_${num}" min="0" step="0.5" placeholder="0" onchange="calcularTarefa(${num})">
                </td>
                <td>
                    <select id="incerteza_${num}" onchange="calcularTarefa(${num})">
                        <option value="Não">Não</option>
                        <option value="Sim">Sim</option>
                    </select>
                </td>
                <td class="calculated">
                    <strong id="total_${num}">0.0</strong>
                </td>
                <td class="actions">
                    <button class="btn btn-danger btn-small" onclick="removerTarefa(${num})" title="Remover esta tarefa">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
            tarefasIds.push(num);
        }

        function adicionarTarefa() {
            tarefasCount++;
            adicionarLinhaTarefa(tarefasCount);
            setupDragAndDrop();
            mostrarNotificacao('Tarefa adicionada com sucesso!', 'success');
            salvarAutomatico();
        }

        function removerTarefa(num) {
            const row = document.getElementById(`tarefa_row_${num}`);
            if (row) {
                row.remove();
                tarefasIds = tarefasIds.filter(id => id !== num);
                renumerarTarefas();
                calcularResumo();
                salvarAutomatico();
                mostrarNotificacao('Tarefa removida!', 'info');
            }
        }

        function removerUltimaTarefa() {
            if (tarefasIds.length <= 1) {
                mostrarNotificacao('Deve haver pelo menos uma tarefa!', 'error');
                return;
            }
            const ultimaId = tarefasIds[tarefasIds.length - 1];
            removerTarefa(ultimaId);
        }

        function renumerarTarefas() {
            const tbody = document.getElementById('tarefasBody');
            const rows = tbody.getElementsByTagName('tr');
            tarefasIds = [];
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                cells[1].innerHTML = `<strong>${i + 1}</strong>`;
                
                // Atualizar tarefasIds na ordem atual
                const rowId = rows[i].id.replace('tarefa_row_', '');
                tarefasIds.push(parseInt(rowId));
            }
        }

        // ============== CÁLCULOS ==============
        function calcularTarefa(num) {
            const horasElement = document.getElementById(`horas_${num}`);
            if (!horasElement) return;
            
            const horas = parseFloat(horasElement.value) || 0;
            
            if (horas === 0) {
                const totalElement = document.getElementById(`total_${num}`);
                if (totalElement) totalElement.textContent = '0.0';
                calcularResumo();
                salvarAutomatico();
                return;
            }

            const depElement = document.getElementById(`dep_${num}`);
            const temDep = depElement ? depElement.value === 'Sim' : false;
            const fatorDep = temDep ? parseFloat(document.getElementById('fatorDep').value) : 1;
            
            const incertezaElement = document.getElementById(`incerteza_${num}`);
            const temIncerteza = incertezaElement ? incertezaElement.value === 'Sim' : false;
            const percIncerteza = parseFloat(document.getElementById('percIncerteza').value) / 100;

            // Tempo de desenvolvimento
            const tempoDev = horas * fatorDep;
            const tempoFinal = temIncerteza ? tempoDev * (1 + percIncerteza) : tempoDev;

            const totalElement = document.getElementById(`total_${num}`);
            if (totalElement) totalElement.textContent = tempoFinal.toFixed(1);
            
            calcularResumo();
            salvarAutomatico();
        }

        function calcularResumo() {
            let totalHorasDev = 0;
            
            tarefasIds.forEach(id => {
                const totalElement = document.getElementById(`total_${id}`);
                if (totalElement) {
                    const total = parseFloat(totalElement.textContent) || 0;
                    totalHorasDev += total;
                }
            });

            // Calcular tempos adicionais
            const percQA = parseFloat(document.getElementById('percQA').value) / 100;
            const totalHorasQA = totalHorasDev * percQA;
            
            const percDoc = parseFloat(document.getElementById('percDoc').value) / 100;
            const totalHorasDoc = totalHorasDev * percDoc;
            
            const incluirTesteFluxo = document.getElementById('incluirTesteFluxo').checked;
            const horasTesteFluxo = incluirTesteFluxo ? parseFloat(document.getElementById('horasTesteFluxo').value) : 0;
            
            const percCorrecoes = parseFloat(document.getElementById('percCorrecoes').value) / 100;
            const totalHorasCorrecoes = totalHorasDev * percCorrecoes;
            
            const totalHorasGeral = totalHorasDev + totalHorasQA + totalHorasDoc + horasTesteFluxo + totalHorasCorrecoes;

            document.getElementById('totalHorasDev').textContent = totalHorasDev.toFixed(1) + 'h';
            document.getElementById('totalHorasQA').textContent = totalHorasQA.toFixed(1) + 'h';
            document.getElementById('totalHorasDoc').textContent = totalHorasDoc.toFixed(1) + 'h';
            document.getElementById('totalHorasTesteFluxo').textContent = horasTesteFluxo.toFixed(1) + 'h';
            document.getElementById('totalHorasCorrecoes').textContent = totalHorasCorrecoes.toFixed(1) + 'h';
            document.getElementById('totalHoras').textContent = totalHorasGeral.toFixed(1) + 'h';

            const dataInicio = document.getElementById('dataInicio').value;
            if (dataInicio) {
                document.getElementById('dataInicioSummary').textContent = formatarData(dataInicio);
                calcularTimeline(dataInicio, totalHorasDev, totalHorasQA, horasTesteFluxo, totalHorasCorrecoes);
            } else {
                document.getElementById('dataInicioSummary').textContent = '--/--/----';
                document.getElementById('dataTerminoDev').textContent = '--/--/----';
                document.getElementById('dataTermino').textContent = '--/--/----';
                
                const timelineContainer = document.getElementById('timelineContainer');
                timelineContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">Configure as informações acima para visualizar a linha do tempo das entregas.</p>';
            }
        }

        function calcularTimeline(dataInicio, totalHorasDev, totalHorasQA, horasTesteFluxo, totalHorasCorrecoes) {
            const isEstagiario = document.getElementById('isEstagiario').checked;
            const horasPorDia = isEstagiario ? 6 : 9; // 9h trabalhadas por dia (8-12 e 13-18)
            const periodoInicio = document.getElementById('periodoInicio').value;
            
            // Manhã: 4h (8-12), Tarde: 5h (13-18)
            const horasManha = 4;
            const horasTarde = 5;
            
            let dataAtual = new Date(dataInicio + 'T00:00:00');
            let horasRestantes = 0;
            
            // Configurar horas restantes baseado no período e tipo de contrato
            if (isEstagiario) {
                horasRestantes = periodoInicio === 'manha' ? 6 : 0;
            } else {
                horasRestantes = periodoInicio === 'manha' ? horasManha : horasTarde;
            }
            
            const timeline = [];
            
            // Calcular datas de cada tarefa
            tarefasIds.forEach((id, index) => {
                const tarefaElement = document.getElementById(`tarefa_${id}`);
                const tarefa = tarefaElement ? tarefaElement.value : '';
                const totalElement = document.getElementById(`total_${id}`);
                const horasTarefa = totalElement ? parseFloat(totalElement.textContent) : 0;
                
                if (horasTarefa > 0 && tarefa.trim()) {
                    let horasProcessadas = 0;
                    const dataIniciaTarefa = new Date(dataAtual);
                    
                    while (horasProcessadas < horasTarefa) {
                        // Pular finais de semana
                        while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                            dataAtual.setDate(dataAtual.getDate() + 1);
                            horasRestantes = horasPorDia;
                        }
                        
                        const horasDisponiveis = Math.min(horasRestantes, horasTarefa - horasProcessadas);
                        horasProcessadas += horasDisponiveis;
                        horasRestantes -= horasDisponiveis;
                        
                        if (horasRestantes === 0) {
                            dataAtual.setDate(dataAtual.getDate() + 1);
                            // Pular finais de semana
                            while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                                dataAtual.setDate(dataAtual.getDate() + 1);
                            }
                            horasRestantes = horasPorDia;
                        }
                    }
                    
                    const dataTerminaTarefa = new Date(dataAtual);
                    
                    timeline.push({
                        numero: index + 1,
                        tarefa: tarefa,
                        horas: horasTarefa,
                        dataInicio: formatarData(dataToString(dataIniciaTarefa)),
                        dataTermino: formatarData(dataToString(dataTerminaTarefa)),
                        tipo: 'dev'
                    });
                }
            });
            
            // Data de término do desenvolvimento
            const dataTerminoDev = new Date(dataAtual);
            document.getElementById('dataTerminoDev').textContent = formatarData(dataToString(dataTerminoDev));
            
            // Calcular período de QA
            if (totalHorasQA > 0) {
                const dataIniciaQA = new Date(dataAtual);
                let horasQAProcessadas = 0;
                
                while (horasQAProcessadas < totalHorasQA) {
                    while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                        dataAtual.setDate(dataAtual.getDate() + 1);
                    }
                    
                    const horasDisponiveis = Math.min(horasRestantes, totalHorasQA - horasQAProcessadas);
                    horasQAProcessadas += horasDisponiveis;
                    horasRestantes -= horasDisponiveis;
                    
                    if (horasRestantes === 0) {
                        dataAtual.setDate(dataAtual.getDate() + 1);
                        while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                            dataAtual.setDate(dataAtual.getDate() + 1);
                        }
                        horasRestantes = horasPorDia;
                    }
                }
                
                timeline.push({
                    numero: 'QA',
                    tarefa: 'Testes de Qualidade (QA)',
                    horas: totalHorasQA,
                    dataInicio: formatarData(dataToString(dataIniciaQA)),
                    dataTermino: formatarData(dataToString(dataAtual)),
                    tipo: 'qa'
                });
            }
            
            // Calcular Teste de Fluxo
            if (horasTesteFluxo > 0) {
                const dataIniciaTeste = new Date(dataAtual);
                let horasTesteProcessadas = 0;
                
                while (horasTesteProcessadas < horasTesteFluxo) {
                    while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                        dataAtual.setDate(dataAtual.getDate() + 1);
                    }
                    
                    const horasDisponiveis = Math.min(horasRestantes, horasTesteFluxo - horasTesteProcessadas);
                    horasTesteProcessadas += horasDisponiveis;
                    horasRestantes -= horasDisponiveis;
                    
                    if (horasRestantes === 0) {
                        dataAtual.setDate(dataAtual.getDate() + 1);
                        while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                            dataAtual.setDate(dataAtual.getDate() + 1);
                        }
                        horasRestantes = horasPorDia;
                    }
                }
                
                timeline.push({
                    numero: 'TF',
                    tarefa: 'Teste de Fluxo Básico',
                    horas: horasTesteFluxo,
                    dataInicio: formatarData(dataToString(dataIniciaTeste)),
                    dataTermino: formatarData(dataToString(dataAtual)),
                    tipo: 'teste'
                });
            }
            
            // Calcular Correções
            if (totalHorasCorrecoes > 0) {
                const dataIniciaCorrecao = new Date(dataAtual);
                let horasCorrecoesProcessadas = 0;
                
                while (horasCorrecoesProcessadas < totalHorasCorrecoes) {
                    while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                        dataAtual.setDate(dataAtual.getDate() + 1);
                    }
                    
                    const horasDisponiveis = Math.min(horasRestantes, totalHorasCorrecoes - horasCorrecoesProcessadas);
                    horasCorrecoesProcessadas += horasDisponiveis;
                    horasRestantes -= horasDisponiveis;
                    
                    if (horasRestantes === 0) {
                        dataAtual.setDate(dataAtual.getDate() + 1);
                        while (dataAtual.getDay() === 0 || dataAtual.getDay() === 6) {
                            dataAtual.setDate(dataAtual.getDate() + 1);
                        }
                        horasRestantes = horasPorDia;
                    }
                }
                
                timeline.push({
                    numero: 'CR',
                    tarefa: 'Tempo para Correções',
                    horas: totalHorasCorrecoes,
                    dataInicio: formatarData(dataToString(dataIniciaCorrecao)),
                    dataTermino: formatarData(dataToString(dataAtual)),
                    tipo: 'correcao'
                });
            }
            
            // Data final do projeto
            document.getElementById('dataTermino').textContent = formatarData(dataToString(dataAtual));
            
            // Salvar timeline globalmente
            timelineGlobal = timeline;
            
            // Renderizar timeline
            renderTimeline(timeline);
        }

        function dataToString(data) {
            const ano = data.getFullYear();
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');
            return `${ano}-${mes}-${dia}`;
        }

        function renderTimeline(timeline) {
            const container = document.getElementById('timelineContainer');
            
            if (timeline.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">Nenhuma tarefa com horas estimadas.</p>';
                return;
            }
            
            let html = '';
            
            timeline.forEach(item => {
                const isQA = item.tipo === 'qa';
                const isTeste = item.tipo === 'teste';
                const isCorrecao = item.tipo === 'correcao';
                const icon = isQA ? '<i class="fas fa-bug"></i>' : isTeste ? '<i class="fas fa-vial"></i>' : isCorrecao ? '<i class="fas fa-wrench"></i>' : item.numero;
                const iconClass = isQA ? 'qa' : isTeste ? 'teste' : isCorrecao ? 'correcao' : '';
                const titleIcon = isQA ? '<i class="fas fa-vial"></i>' : isTeste ? '<i class="fas fa-flask"></i>' : isCorrecao ? '<i class="fas fa-tools"></i>' : '<i class="fas fa-code"></i>';
                
                html += `
                    <div class="timeline-item ${iconClass}">
                        <div class="timeline-icon">${icon}</div>
                        <div class="timeline-content">
                            <h4>
                                ${titleIcon}
                                ${item.tarefa.length > 50 ? item.tarefa.substring(0, 50) + '...' : item.tarefa}
                            </h4>
                            <p><strong>Horas:</strong> ${item.horas.toFixed(1)}h</p>
                            <p><strong>Início:</strong> ${item.dataInicio} | <strong>Término:</strong> ${item.dataTermino}</p>
                            ${!isQA && !isTeste && !isCorrecao && item.tarefa.length > 50 ? `<div class="task-desc">${item.tarefa}</div>` : ''}
                            <span class="timeline-date">
                                <i class="fas fa-calendar-check"></i> Entregar até ${item.dataTermino}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function formatarData(dataStr) {
            if (!dataStr) return '--/--/----';
            const [ano, mes, dia] = dataStr.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function calcularTudo() {
            tarefasIds.forEach(id => {
                calcularTarefa(id);
            });
        }

        // ============== UI ==============
        function toggleConfig() {
            const section = document.getElementById('configSection');
            section.classList.toggle('active');
        }

        function abrirModalLimpar() {
            document.getElementById('modalLimpar').classList.add('active');
        }

        function fecharModalLimpar() {
            document.getElementById('modalLimpar').classList.remove('active');
        }

        // ============== STORAGE ==============
        function salvarAutomatico() {
            setTimeout(() => {
                salvarDados(true);
            }, 500);
        }

        function salvarDados(silencioso = false) {
            const dados = {
                config: {
                    percQA: document.getElementById('percQA').value,
                    fatorDep: document.getElementById('fatorDep').value,
                    percIncerteza: document.getElementById('percIncerteza').value,
                    percDoc: document.getElementById('percDoc').value,
                    horasTesteFluxo: document.getElementById('horasTesteFluxo').value,
                    percCorrecoes: document.getElementById('percCorrecoes').value
                },
                info: {
                    nomeDev: document.getElementById('nomeDev').value,
                    nomeDemanda: document.getElementById('nomeDemanda').value,
                    dataInicio: document.getElementById('dataInicio').value,
                    periodoInicio: document.getElementById('periodoInicio').value,
                    isEstagiario: document.getElementById('isEstagiario').checked,
                    incluirTesteFluxo: document.getElementById('incluirTesteFluxo').checked
                },
                tarefas: [],
                tarefasIds: tarefasIds
            };

            tarefasIds.forEach(id => {
                const tarefaElement = document.getElementById(`tarefa_${id}`);
                const depElement = document.getElementById(`dep_${id}`);
                const horasElement = document.getElementById(`horas_${id}`);
                const incertezaElement = document.getElementById(`incerteza_${id}`);
                
                if (tarefaElement) {
                    dados.tarefas.push({
                        id: id,
                        tarefa: tarefaElement.value,
                        dependencia: depElement ? depElement.value : 'Não',
                        horas: horasElement ? horasElement.value : '',
                        incerteza: incertezaElement ? incertezaElement.value : 'Não'
                    });
                }
            });

            salvarNoStorage('estimativaProjetoV7', JSON.stringify(dados));
            
            if (!silencioso) {
                mostrarNotificacao('Dados salvos com sucesso!', 'success');
            }
        }

        function carregarDados() {
            const dadosStr = lerDoStorage('estimativaProjetoV7');
            if (!dadosStr) return;

            try {
                const dados = JSON.parse(dadosStr);

                if (dados.config) {
                    document.getElementById('percQA').value = dados.config.percQA || 30;
                    document.getElementById('fatorDep').value = dados.config.fatorDep || 1.3;
                    document.getElementById('percIncerteza').value = dados.config.percIncerteza || 15;
                    document.getElementById('percDoc').value = dados.config.percDoc || 15;
                    document.getElementById('horasTesteFluxo').value = dados.config.horasTesteFluxo || 4;
                    document.getElementById('percCorrecoes').value = dados.config.percCorrecoes || 20;
                }

                if (dados.info) {
                    document.getElementById('nomeDev').value = dados.info.nomeDev || '';
                    document.getElementById('nomeDemanda').value = dados.info.nomeDemanda || '';
                    document.getElementById('dataInicio').value = dados.info.dataInicio || '';
                    document.getElementById('periodoInicio').value = dados.info.periodoInicio || 'manha';
                    document.getElementById('isEstagiario').checked = dados.info.isEstagiario || false;
                    document.getElementById('incluirTesteFluxo').checked = dados.info.incluirTesteFluxo !== undefined ? dados.info.incluirTesteFluxo : true;
                }

                if (dados.tarefas && dados.tarefas.length > 0) {
                    const tbody = document.getElementById('tarefasBody');
                    tbody.innerHTML = '';
                    tarefasIds = [];
                    
                    dados.tarefas.forEach(tarefa => {
                        adicionarLinhaTarefa(tarefa.id);
                        document.getElementById(`tarefa_${tarefa.id}`).value = tarefa.tarefa || '';
                        document.getElementById(`dep_${tarefa.id}`).value = tarefa.dependencia || 'Não';
                        document.getElementById(`horas_${tarefa.id}`).value = tarefa.horas || '';
                        document.getElementById(`incerteza_${tarefa.id}`).value = tarefa.incerteza || 'Não';
                    });
                    
                    tarefasCount = Math.max(...tarefasIds);
                    setupDragAndDrop();
                }

                calcularTudo();
            } catch (e) {
                console.error('Erro ao carregar dados:', e);
            }
        }

        function limparDados() {
            // Remover do storage
            removerDoStorage('estimativaProjetoV7');
            
            // Limpar campos de configuração
            document.getElementById('percQA').value = 30;
            document.getElementById('fatorDep').value = 1.3;
            document.getElementById('percIncerteza').value = 15;
            document.getElementById('percDoc').value = 15;
            document.getElementById('horasTesteFluxo').value = 4;
            document.getElementById('percCorrecoes').value = 20;
            
            // Limpar informações do desenvolvedor
            document.getElementById('nomeDev').value = '';
            document.getElementById('nomeDemanda').value = '';
            document.getElementById('dataInicio').value = new Date().toISOString().split('T')[0];
            document.getElementById('periodoInicio').value = 'manha';
            document.getElementById('isEstagiario').checked = false;
            document.getElementById('incluirTesteFluxo').checked = true;
            
            // Recriar tarefas vazias
            const tbody = document.getElementById('tarefasBody');
            tbody.innerHTML = '';
            tarefasIds = [];
            tarefasCount = 5;
            
            for (let i = 1; i <= 5; i++) {
                adicionarLinhaTarefa(i);
            }
            
            setupDragAndDrop();
            
            // Limpar resumo
            document.getElementById('totalHorasDev').textContent = '0.0h';
            document.getElementById('totalHorasQA').textContent = '0.0h';
            document.getElementById('totalHorasDoc').textContent = '0.0h';
            document.getElementById('totalHorasTesteFluxo').textContent = '0.0h';
            document.getElementById('totalHorasCorrecoes').textContent = '0.0h';
            document.getElementById('totalHoras').textContent = '0.0h';
            document.getElementById('dataInicioSummary').textContent = '--/--/----';
            document.getElementById('dataTerminoDev').textContent = '--/--/----';
            document.getElementById('dataTermino').textContent = '--/--/----';
            
            // Limpar timeline
            const timelineContainer = document.getElementById('timelineContainer');
            timelineContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">Configure as informações acima para visualizar a linha do tempo das entregas.</p>';
            
            // Limpar timeline global
            timelineGlobal = [];
            
            // Fechar modal
            fecharModalLimpar();
            
            // Mostrar notificação
            mostrarNotificacao('Todos os dados foram limpos!', 'success');
        }

        // ============== EXPORTAR EXCEL ==============
        function exportarExcel() {
            try {
                const nomeDemanda = document.getElementById('nomeDemanda').value || 'Estimativa';
                const nomeDev = document.getElementById('nomeDev').value || 'Desenvolvedor';
                const dataInicio = document.getElementById('dataInicio').value || 'Não definida';
                const periodoInicio = document.getElementById('periodoInicio').value;
                const isEstagiario = document.getElementById('isEstagiario').checked;
                const incluirTesteFluxo = document.getElementById('incluirTesteFluxo').checked;
                const totalHorasDev = document.getElementById('totalHorasDev').textContent;
                const totalHorasQA = document.getElementById('totalHorasQA').textContent;
                const totalHorasDoc = document.getElementById('totalHorasDoc').textContent;
                const totalHorasTesteFluxo = document.getElementById('totalHorasTesteFluxo').textContent;
                const totalHorasCorrecoes = document.getElementById('totalHorasCorrecoes').textContent;
                const totalHoras = document.getElementById('totalHoras').textContent;
                const dataTerminoDev = document.getElementById('dataTerminoDev').textContent;
                const dataTermino = document.getElementById('dataTermino').textContent;

                const wb = XLSX.utils.book_new();

                // ABA 1: RESUMO
                const resumoData = [
                    ['ESTIMATIVA DE PROJETO'],
                    [],
                    ['Informações do Projeto'],
                    ['Nome do Desenvolvedor:', nomeDev],
                    ['É Estagiário?:', isEstagiario ? 'Sim (6h/dia)' : 'Não (9h/dia)'],
                    ['Incluir Teste de Fluxo?:', incluirTesteFluxo ? 'Sim' : 'Não'],
                    ['Nome da Demanda:', nomeDemanda],
                    ['Data de Início:', dataInicio],
                    ['Período de Início:', periodoInicio === 'manha' ? 'Manhã' : 'Tarde'],
                    [],
                    ['Resumo Final'],
                    ['Total Horas Desenvolvimento:', totalHorasDev],
                    ['Total Horas QA/Teste:', totalHorasQA],
                    ['Horas Doc/Reuniões:', totalHorasDoc],
                    ['Horas Teste Fluxo:', totalHorasTesteFluxo],
                    ['Horas Correções:', totalHorasCorrecoes],
                    ['Total Geral de Horas:', totalHoras],
                    ['Data de Término Dev:', dataTerminoDev],
                    ['Data Final (Completo):', dataTermino],
                ];

                const ws1 = XLSX.utils.aoa_to_sheet(resumoData);
                XLSX.utils.book_append_sheet(wb, ws1, 'Resumo');

                // ABA 2: TAREFAS
                const tarefasData = [
                    ['Nº', 'Tarefa Técnica', 'Dependência Externa', 'Horas Estimadas', 'Adicionar Incerteza', 'Total de Horas']
                ];

                tarefasIds.forEach((id, index) => {
                    const tarefaElement = document.getElementById(`tarefa_${id}`);
                    const tarefa = tarefaElement ? tarefaElement.value : '';
                    if (tarefa.trim()) {
                        const depElement = document.getElementById(`dep_${id}`);
                        const horasElement = document.getElementById(`horas_${id}`);
                        const incertezaElement = document.getElementById(`incerteza_${id}`);
                        const totalElement = document.getElementById(`total_${id}`);
                        
                        tarefasData.push([
                            index + 1,
                            tarefa,
                            depElement ? depElement.value : 'Não',
                            horasElement ? (horasElement.value || '0') : '0',
                            incertezaElement ? incertezaElement.value : 'Não',
                            totalElement ? totalElement.textContent : '0.0'
                        ]);
                    }
                });

                const ws2 = XLSX.utils.aoa_to_sheet(tarefasData);
                XLSX.utils.book_append_sheet(wb, ws2, 'Tarefas');

                // ABA 3: CONFIGURAÇÃO
                const configData = [
                    ['Parâmetro', 'Valor'],
                    [],
                    ['Parâmetros de Tempo', ''],
                    ['% Tempo de QA/Teste', document.getElementById('percQA').value + '%'],
                    ['Fator Dependência Externa', document.getElementById('fatorDep').value],
                    ['% Incerteza Padrão', document.getElementById('percIncerteza').value + '%'],
                    [],
                    ['Tempos Adicionais', ''],
                    ['% Doc. e Reuniões', document.getElementById('percDoc').value + '%'],
                    ['Horas Teste Fluxo QA', document.getElementById('horasTesteFluxo').value],
                    ['% Tempo Correções', document.getElementById('percCorrecoes').value + '%'],
                ];

                const ws3 = XLSX.utils.aoa_to_sheet(configData);
                XLSX.utils.book_append_sheet(wb, ws3, 'Configuração');

                // ABA 4: TIMELINE
                const timelineData = [
                    ['Nº', 'Tarefa', 'Horas', 'Data Início', 'Data Término']
                ];

                timelineGlobal.forEach(item => {
                    timelineData.push([
                        item.numero,
                        item.tarefa,
                        item.horas.toFixed(1),
                        item.dataInicio,
                        item.dataTermino
                    ]);
                });

                const ws4 = XLSX.utils.aoa_to_sheet(timelineData);
                XLSX.utils.book_append_sheet(wb, ws4, 'Timeline');

                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const filename = `${nomeDemanda.replace(/\s+/g, '_')}_${timestamp}.xlsx`;

                XLSX.writeFile(wb, filename);
                
                mostrarNotificacao('Excel exportado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao exportar Excel:', error);
                mostrarNotificacao('Erro ao exportar Excel. Tente novamente.', 'error');
            }
        }

        // ============== IMPORTAR EXCEL ==============
        function importarExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            mostrarNotificacao('Importando Excel... Aguarde', 'info');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});

                    if (workbook.SheetNames.includes('Resumo')) {
                        const resumoSheet = workbook.Sheets['Resumo'];
                        const resumoData = XLSX.utils.sheet_to_json(resumoSheet, {header: 1});
                        
                        resumoData.forEach(row => {
                            if (row[0] === 'Nome do Desenvolvedor:' && row[1]) {
                                document.getElementById('nomeDev').value = row[1];
                            }
                            if (row[0] === 'É Estagiário?:' && row[1]) {
                                document.getElementById('isEstagiario').checked = row[1].includes('Sim');
                            }
                            if (row[0] === 'Incluir Teste de Fluxo?:' && row[1]) {
                                document.getElementById('incluirTesteFluxo').checked = row[1].includes('Sim');
                            }
                            if (row[0] === 'Nome da Demanda:' && row[1]) {
                                document.getElementById('nomeDemanda').value = row[1];
                            }
                            if (row[0] === 'Data de Início:' && row[1]) {
                                const dataStr = row[1].toString();
                                if (dataStr.includes('/')) {
                                    const parts = dataStr.split('/');
                                    if (parts.length === 3) {
                                        document.getElementById('dataInicio').value = `${parts[2]}-${parts[1]}-${parts[0]}`;
                                    }
                                } else {
                                    document.getElementById('dataInicio').value = row[1];
                                }
                            }
                            if (row[0] === 'Período de Início:' && row[1]) {
                                document.getElementById('periodoInicio').value = row[1] === 'Manhã' ? 'manha' : 'tarde';
                            }
                        });
                    }

                    if (workbook.SheetNames.includes('Tarefas')) {
                        const tarefasSheet = workbook.Sheets['Tarefas'];
                        const tarefasData = XLSX.utils.sheet_to_json(tarefasSheet, {header: 1});
                        
                        const tbody = document.getElementById('tarefasBody');
                        tbody.innerHTML = '';
                        tarefasIds = [];
                        
                        for (let i = 1; i < tarefasData.length; i++) {
                            const row = tarefasData[i];
                            if (row[1]) {
                                const id = i;
                                adicionarLinhaTarefa(id);
                                
                                document.getElementById(`tarefa_${id}`).value = row[1] || '';
                                document.getElementById(`dep_${id}`).value = row[2] || 'Não';
                                document.getElementById(`horas_${id}`).value = row[3] || '';
                                document.getElementById(`incerteza_${id}`).value = row[4] || 'Não';
                            }
                        }
                        
                        tarefasCount = tarefasIds.length > 0 ? Math.max(...tarefasIds) : 0;
                        setupDragAndDrop();
                    }

                    if (workbook.SheetNames.includes('Configuração')) {
                        const configSheet = workbook.Sheets['Configuração'];
                        const configData = XLSX.utils.sheet_to_json(configSheet, {header: 1});
                        
                        configData.forEach(row => {
                            if (row[0] === '% Tempo de QA/Teste' && row[1]) {
                                document.getElementById('percQA').value = String(row[1]).replace('%', '');
                            }
                            if (row[0] === 'Fator Dependência Externa' && row[1]) {
                                document.getElementById('fatorDep').value = row[1];
                            }
                            if (row[0] === '% Incerteza Padrão' && row[1]) {
                                document.getElementById('percIncerteza').value = String(row[1]).replace('%', '');
                            }
                            if (row[0] === '% Doc. e Reuniões' && row[1]) {
                                document.getElementById('percDoc').value = String(row[1]).replace('%', '');
                            }
                            if (row[0] === 'Horas Teste Fluxo QA' && row[1]) {
                                document.getElementById('horasTesteFluxo').value = row[1];
                            }
                            if (row[0] === '% Tempo Correções' && row[1]) {
                                document.getElementById('percCorrecoes').value = String(row[1]).replace('%', '');
                            }
                        });
                    }

                    calcularTudo();
                    salvarDados();
                    mostrarNotificacao('Excel importado com sucesso!', 'success');
                    
                } catch (error) {
                    console.error('Erro ao importar:', error);
                    mostrarNotificacao('Erro ao importar Excel. Verifique o formato do arquivo.', 'error');
                }
            };

            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        // ============== EXPORTAR PDF ==============
        async function exportarPDF() {
            try {
                mostrarNotificacao('Gerando PDF... Aguarde alguns segundos', 'info');
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const nomeDemanda = document.getElementById('nomeDemanda').value || 'Estimativa de Projeto';
                const nomeDev = document.getElementById('nomeDev').value || 'Desenvolvedor';
                const isEstagiario = document.getElementById('isEstagiario').checked;
                const incluirTesteFluxo = document.getElementById('incluirTesteFluxo').checked;
                const dataInicio = document.getElementById('dataInicio').value ? formatarData(document.getElementById('dataInicio').value) : 'Não definida';
                const periodoInicio = document.getElementById('periodoInicio').value === 'manha' ? 'Manhã' : 'Tarde';
                
                // Página de Capa
                pdf.setFillColor(124, 58, 237);
                pdf.rect(0, 0, 210, 297, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(32);
                pdf.setFont(undefined, 'bold');
                pdf.text('ESTIMATIVA DE PROJETO', 105, 120, { align: 'center' });
                
                pdf.setFontSize(18);
                pdf.setFont(undefined, 'normal');
                pdf.text(nomeDemanda, 105, 140, { align: 'center' });
                
                pdf.setFontSize(14);
                const dataGeracao = new Date().toLocaleDateString('pt-BR');
                pdf.text(`Gerado em: ${dataGeracao}`, 105, 160, { align: 'center' });
                
                // Página 2 - Informações do Projeto
                pdf.addPage();
                
                // Cabeçalho
                pdf.setFillColor(124, 58, 237);
                pdf.rect(0, 0, 210, 40, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.setFont(undefined, 'bold');
                pdf.text('Informações do Projeto', 105, 25, { align: 'center' });
                
                let y = 60;
                
                // Box Informações
                pdf.setFillColor(243, 232, 255);
                pdf.rect(15, y - 5, 180, 70, 'F');
                
                pdf.setTextColor(0, 0, 0);
                pdf.setFontSize(12);
                pdf.setFont(undefined, 'bold');
                pdf.text('Desenvolvedor:', 25, y);
                pdf.setFont(undefined, 'normal');
                pdf.text(nomeDev, 70, y);
                
                y += 10;
                pdf.setFont(undefined, 'bold');
                pdf.text('Tipo:', 25, y);
                pdf.setFont(undefined, 'normal');
                pdf.text(isEstagiario ? 'Estagiário (6h/dia)' : 'Normal (9h/dia)', 70, y);
                
                y += 10;
                pdf.setFont(undefined, 'bold');
                pdf.text('Incluir Teste Fluxo:', 25, y);
                pdf.setFont(undefined, 'normal');
                pdf.text(incluirTesteFluxo ? 'Sim' : 'Não', 70, y);
                
                y += 10;
                pdf.setFont(undefined, 'bold');
                pdf.text('Data de Início:', 25, y);
                pdf.setFont(undefined, 'normal');
                pdf.text(`${dataInicio} - ${periodoInicio}`, 70, y);
                
                y += 10;
                pdf.setFont(undefined, 'bold');
                pdf.text('Data Término Dev:', 25, y);
                pdf.setFont(undefined, 'normal');
                pdf.text(document.getElementById('dataTerminoDev').textContent, 70, y);
                
                y += 10;
                pdf.setFont(undefined, 'bold');
                pdf.text('Data Final:', 25, y);
                pdf.setFont(undefined, 'normal');
                pdf.text(document.getElementById('dataTermino').textContent, 70, y);
                
                y += 20;
                
                // Descrição da Demanda
                pdf.setFillColor(254, 243, 199);
                pdf.rect(15, y - 5, 180, 50, 'F');
                
                pdf.setFont(undefined, 'bold');
                pdf.setFontSize(12);
                pdf.text('Descrição da Demanda:', 25, y);
                
                y += 10;
                pdf.setFont(undefined, 'normal');
                pdf.setFontSize(10);
                const demandaTexto = nomeDemanda;
                const linhasDemanda = pdf.splitTextToSize(demandaTexto, 160);
                pdf.text(linhasDemanda, 25, y);
                
                // Página 3 - Resumo Final
                pdf.addPage();
                
                // Cabeçalho
                pdf.setFillColor(124, 58, 237);
                pdf.rect(0, 0, 210, 40, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.setFont(undefined, 'bold');
                pdf.text('Resumo Final', 105, 25, { align: 'center' });
                
                y = 60;
                
                // Grid de Cards
                const cards = [
                    { label: 'Desenvolvimento', value: document.getElementById('totalHorasDev').textContent, color: [209, 250, 229] },
                    { label: 'QA/Teste', value: document.getElementById('totalHorasQA').textContent, color: [191, 219, 254] },
                    { label: 'Doc/Reuniões', value: document.getElementById('totalHorasDoc').textContent, color: [254, 249, 195] },
                    { label: 'Teste Fluxo', value: document.getElementById('totalHorasTesteFluxo').textContent, color: [221, 214, 254] },
                    { label: 'Correções', value: document.getElementById('totalHorasCorrecoes').textContent, color: [254, 215, 170] },
                    { label: 'TOTAL GERAL', value: document.getElementById('totalHoras').textContent, color: [196, 181, 253] }
                ];
                
                let cardX = 15;
                let cardY = y;
                
                cards.forEach((card, index) => {
                    if (index === 3) {
                        cardX = 15;
                        cardY += 50;
                    }
                    
                    // Card background
                    pdf.setFillColor(...card.color);
                    pdf.rect(cardX, cardY, 60, 40, 'F');
                    
                    // Border
                    pdf.setDrawColor(124, 58, 237);
                    pdf.setLineWidth(0.5);
                    pdf.rect(cardX, cardY, 60, 40);
                    
                    // Label
                    pdf.setTextColor(55, 65, 81);
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(card.label, cardX + 30, cardY + 12, { align: 'center' });
                    
                    // Value
                    pdf.setFontSize(18);
                    pdf.setTextColor(109, 40, 217);
                    pdf.text(card.value, cardX + 30, cardY + 28, { align: 'center' });
                    
                    cardX += 65;
                });
                
                // Página 4+ - Timeline
                pdf.addPage();
                
                // Cabeçalho
                pdf.setFillColor(20, 184, 166);
                pdf.rect(0, 0, 210, 40, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.setFont(undefined, 'bold');
                pdf.text('Linha do Tempo', 105, 25, { align: 'center' });
                
                y = 55;
                
                // Timeline Items
                timelineGlobal.forEach((item, index) => {
                    if (y > 260) {
                        pdf.addPage();
                        y = 20;
                    }
                    
                    const numero = item.numero.toString();
                    const titulo = item.tarefa;
                    const horas = item.horas;
                    const inicio = item.dataInicio;
                    const termino = item.dataTermino;
                    
                    const isQA = item.tipo === 'qa';
                    const isTeste = item.tipo === 'teste';
                    const isCorrecao = item.tipo === 'correcao';
                    
                    // Background color based on type
                    if (isQA) {
                        pdf.setFillColor(209, 250, 229);
                    } else if (isTeste) {
                        pdf.setFillColor(191, 219, 254);
                    } else if (isCorrecao) {
                        pdf.setFillColor(254, 243, 199);
                    } else {
                        pdf.setFillColor(243, 232, 255);
                    }
                    
                    pdf.rect(15, y - 5, 180, 25, 'F');
                    
                    // Número/Ícone
                    pdf.setFillColor(124, 58, 237);
                    if (isQA) pdf.setFillColor(16, 185, 129);
                    if (isTeste) pdf.setFillColor(59, 130, 246);
                    if (isCorrecao) pdf.setFillColor(245, 158, 11);
                    
                    pdf.circle(25, y + 5, 5, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(8);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(numero.substring(0, 3), 25, y + 7, { align: 'center' });
                    
                    // Título
                    pdf.setTextColor(0, 0, 0);
                    pdf.setFontSize(11);
                    pdf.setFont(undefined, 'bold');
                    const tituloLimpo = titulo.substring(0, 60);
                    pdf.text(tituloLimpo, 35, y + 3);
                    
                    // Detalhes
                    pdf.setFontSize(9);
                    pdf.setFont(undefined, 'normal');
                    pdf.text(`${horas.toFixed(1)}h | ${inicio} até ${termino}`, 35, y + 11);
                    
                    y += 28;
                });
                
                // Página Final - Tarefas Detalhadas
                pdf.addPage();
                
                // Cabeçalho
                pdf.setFillColor(124, 58, 237);
                pdf.rect(0, 0, 210, 40, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.setFont(undefined, 'bold');
                pdf.text('Lista de Tarefas', 105, 25, { align: 'center' });
                
                y = 55;
                
                tarefasIds.forEach((id, index) => {
                    const tarefaElement = document.getElementById(`tarefa_${id}`);
                    const tarefa = tarefaElement ? tarefaElement.value : '';
                    
                    if (tarefa.trim()) {
                        if (y > 260) {
                            pdf.addPage();
                            y = 20;
                        }
                        
                        const horasElement = document.getElementById(`horas_${id}`);
                        const totalElement = document.getElementById(`total_${id}`);
                        const depElement = document.getElementById(`dep_${id}`);
                        const incertezaElement = document.getElementById(`incerteza_${id}`);
                        
                        // Background
                        pdf.setFillColor(249, 250, 251);
                        pdf.rect(15, y - 5, 180, 30, 'F');
                        
                        // Border
                        pdf.setDrawColor(229, 231, 235);
                        pdf.setLineWidth(0.3);
                        pdf.rect(15, y - 5, 180, 30);
                        
                        // Número
                        pdf.setFillColor(124, 58, 237);
                        pdf.circle(25, y + 7, 5, 'F');
                        pdf.setTextColor(255, 255, 255);
                        pdf.setFontSize(8);
                        pdf.setFont(undefined, 'bold');
                        pdf.text(`${index + 1}`, 25, y + 9, { align: 'center' });
                        
                        // Tarefa
                        pdf.setTextColor(0, 0, 0);
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'bold');
                        const tarefaLinhas = pdf.splitTextToSize(tarefa, 140);
                        pdf.text(tarefaLinhas.slice(0, 2), 35, y + 2);
                        
                        // Detalhes
                        pdf.setFontSize(8);
                        pdf.setFont(undefined, 'normal');
                        let detalhes = `Horas: ${horasElement?.value || '0'}h | Total: ${totalElement?.textContent || '0.0'}h`;
                        if (depElement?.value === 'Sim') detalhes += ' | Dep. Externa';
                        if (incertezaElement?.value === 'Sim') detalhes += ' | Incerteza';
                        
                        pdf.text(detalhes, 35, y + 18);
                        
                        y += 33;
                    }
                });
                
                // Rodapé em todas as páginas
                const pageCount = pdf.internal.getNumberOfPages();
                pdf.setFontSize(8);
                pdf.setTextColor(107, 114, 128);
                
                for (let i = 1; i <= pageCount; i++) {
                    pdf.setPage(i);
                    pdf.text(`Página ${i} de ${pageCount}`, 105, 287, { align: 'center' });
                    pdf.text(`Estimativa de Projeto - ${nomeDemanda}`, 105, 292, { align: 'center' });
                }
                
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const filename = `Estimativa_${nomeDemanda.replace(/\s+/g, '_')}_${timestamp}.pdf`;
                
                pdf.save(filename);
                
                mostrarNotificacao('PDF exportado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao exportar PDF:', error);
                mostrarNotificacao('Erro ao exportar PDF. Tente novamente.', 'error');
            }
        }

        // ============== INICIALIZAÇÃO ==============
        window.onload = function() {
            criarTarefas(5);
            carregarDados();
            
            if (!document.getElementById('dataInicio').value) {
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('dataInicio').value = hoje;
            }
            
            calcularTudo();
            
            mostrarNotificacao('Sistema carregado com sucesso!', 'success');
        };

        window.addEventListener('beforeunload', function() {
            salvarDados(true);
        });
    </script>
</body>
</html>
